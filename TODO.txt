TODO:
- do a pass through the rest of the code
